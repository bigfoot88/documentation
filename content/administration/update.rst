.. _setup/update:

=============================
更新odoo安装
=============================

指南
============

为了享受最新的改进、安全修复、错误修正和性能提升，你可能需要不时更新你的 Odoo 安装。

本指南仅适用于在你自己的托管基础设施上使用 Odoo 的情况。如果你使用的是 Odoo 云解决方案之一，更新会自动为你执行。

软件更新相关的术语往往令人困惑，因此这里有一些初步定义：

Updating (an Odoo installation)
  指的是获取你当前 Odoo 版本最新修订版的过程。例如，将你的 Odoo Enterprise 12.0 更新到最新修订版。
  这不会直接改变你 Odoo 数据库的内容，并且可以通过重新安装以前的源代码修订版来撤销。

Upgrading (an Odoo database)
  指的是一种复杂的数据处理操作，数据库的结构和内容会被永久性地更改以使其兼容新的 Odoo 版本。
  这个操作是不可逆的，通常通过 Odoo 的 `数据库升级服务 <https://upgrade.odoo.com>`_ 来完成，当你决定切换到新的 Odoo 版本时。
  历史上，这个过程也被称为“迁移”，因为它涉及在数据库内部移动数据，即使数据库在升级后可能仍在相同的物理位置。

本页描述了将 Odoo 安装更新到最新版本的典型步骤。如果你想了解有关升级数据库的更多信息，请访问 `Odoo 升级页面 <https://upgrade.odoo.com>`_。

简而言之
=========

更新 Odoo 通过简单地在当前安装上重新安装最新版本的 Odoo Edition 来完成。这将保留你的数据而不做任何更改，只要你不卸载 Odoo 附带的数据库引擎 PostgreSQL。

更新的主要参考是我们的 :ref:`安装指南 <setup/install>`，其中解释了常见的安装方法。

更新也最适合由最初部署 Odoo 的人来完成，因为过程非常相似。

.. note:: 我们总是建议下载一个全新的最新 Odoo 版本，而不是手动应用补丁，例如随安全公告一起发布的安全补丁。
          补丁主要是为高度定制的安装提供的，或者为那些在测试完整更新时更喜欢临时应用最小更改的技术人员提供。

步骤 1：下载更新的 Odoo 版本
=============================

中央下载页面是 https://www.odoo.com/page/download。如果你看到 Odoo Enterprise 下载的“购买”链接，请确保你使用链接到你的 Odoo Enterprise 订阅的相同登录账户登录 Odoo.com。

或者，你可以使用包含在你的 Odoo Enterprise 购买确认邮件中的唯一下载链接。

.. note:: 如果你通过 Github 安装，下载更新版本不是必需的（见下文）

步骤 2：备份你的数据库
=======================

更新过程非常安全，不会更改你的数据。但是，在对安装进行任何更改之前，最好进行完整的数据库备份，并将其存储在安全的地方，如另一台计算机上。

如果你没有禁用数据库管理器屏幕（参见 :ref:`此处 <security>` 了解为何你应该禁用它），你可以使用它（在你的数据库选择屏幕底部的链接）来下载你的数据库备份。如果你禁用了它，请使用与你平时备份相同的程序。

步骤 3：安装更新版本
======================

选择与你当前安装匹配的方法：

打包安装程序
-------------

如果你使用我们网站上下载的安装包安装了 Odoo（推荐的方法），更新非常简单。
你所需要做的就是下载与你的系统对应的安装包（见步骤 #1）并安装在你的服务器上。它们每天更新并包含最新的安全修复。
通常，你只需双击安装包即可在当前安装上安装。
安装包后，请务必重启 Odoo 服务或重新启动服务器，便可完成更新。

源代码安装（Tarball）
----------------------
如果你最初使用“tarball”版本（源代码归档）安装了 Odoo，你需要用更新版本替换安装目录。首先从 Odoo.com 下载最新的 tarball。它们每天更新并包含最新的安全修复（见步骤 #1）。
下载包后，将其解压缩到服务器上的临时位置。

你将得到一个标有源代码版本的文件夹，例如“odoo-12.0+e.20180719”，其中包含一个“odoo.egg-info”文件夹和实际的源代码文件夹“odoo”（对于 Odoo 10 及更高版本）或“openerp”（对于旧版本）。
你可以忽略 odoo.egg-info 文件夹。找到当前安装部署的文件夹，并用你刚刚解压的归档文件中的新“odoo”或“openerp”文件夹替换它。

确保匹配文件夹布局，例如，源代码中包含的新“addons”文件夹应该与之前的路径完全相同。接下来，注意你可能在旧文件夹中手动复制或修改的任何特定配置文件，并将它们复制到新文件夹中。
最后，重启 Odoo 服务或重新启动机器，即可完成。

源代码安装（Github）
---------------------
如果你最初使用官方库的完整 Github 克隆安装了 Odoo，更新程序需要你通过 git 拉取最新的源代码。
进入每个库的目录（主要的 Odoo 库和 Enterprise 库），并运行以下命令::

     git fetch
     git rebase --autostash

如果你在本地编辑了 Odoo 源代码，最后一条命令可能会遇到源代码冲突。
错误消息会提供有冲突的文件列表，你需要手动解决这些冲突，通过编辑它们并决定保留哪部分代码。

或者，如果你更愿意简单地放弃冲突的更改并恢复官方版本，你可以使用以下命令::

     git reset --hard

最后，重启 Odoo 服务或重新启动机器，即可完成。

Docker
------

请参阅我们的 `Docker 镜像文档 <https://hub.docker.com/_/odoo/>`_ 获取特定的更新说明。
